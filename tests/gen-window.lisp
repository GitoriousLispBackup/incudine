(in-package :incudine-tests)

(defun gen-window-test-1 (fn &optional (size 64))
  (cffi:with-foreign-object (arr 'sample size)
    (funcall fn arr size)
    (loop for i below size collect (sample->fixnum (* 1000 (smp-ref arr i))))))

(deftest gen-win-hanning
    (gen-window-test-1 (gen:hanning))
  (0 2 9 21 38 59 84 113 146 182 222 264 308 354 402 450 500 549 597 645
   691 735 777 817 853 886 915 940 961 978 990 997 1000 997 990 978 961
   940 915 886 853 817 777 735 691 645 597 549 499 450 402 354 308 264 222
   182 146 113 84 59 38 21 9 2))

(deftest gen-win-hamming
    (gen-window-test-1 (gen:hamming))
  (80 82 88 99 115 134 157 184 214 248 284 323 363 406 450 494 540 585
   629 673 716 756 795 831 865 895 922 945 964 980 991 997 1000 997 991
   980 964 945 922 895 865 831 795 756 716 673 629 585 540 494 450 406
   363 323 284 248 214 184 157 134 115 99 88 82))

(deftest gen-win-blackman
    (gen-window-test-1 (gen:blackman))
  (-1 0 3 8 14 23 34 49 66 87 111 139 172 208 248 292 339 390 443 498
   554 611 667 721 773 822 866 905 938 964 984 996 999 996 984 964 938
   905 866 822 773 721 667 611 554 498 443 390 339 292 248 208 172 139
   111 87 66 49 34 23 14 8 3 0))

(deftest gen-win-sine
    (gen-window-test-1 (gen:sine-window))
  (0 49 98 146 195 242 290 336 382 427 471 514 555 595 634 671 707 740
   773 803 831 857 881 903 923 941 956 970 980 989 995 998 1000 998 995
   989 980 970 956 941 923 903 881 857 831 803 773 740 707 671 634 595
   555 514 471 427 382 336 290 242 195 146 98 49))

(deftest gen-win-bartlett
    (gen-window-test-1 (gen:bartlett))
  (0 31 62 93 125 156 187 218 250 281 312 343 375 406 437 468 500 531
   562 593 625 656 687 718 750 781 812 843 875 906 937 968 1000 968 937
   906 875 843 812 781 750 718 687 656 625 593 562 531 500 468 437 406
   375 343 312 281 250 218 187 156 125 93 62 31))
